import { View, Text, StyleSheet, ScrollView, Alert } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { useTheme } from '../theme';
import { Card, Button } from '../components';
// TODO(eliminar lÃ­nea 5): Remover import de constantes mock
import { MOCK_MATCH } from '../constants';
// BACKEND READY - Descomentar:
// import { api, API_ENDPOINTS } from '../services';
import { useState } from 'react';
// BACKEND READY - Descomentar: import { useEffect } from 'react';

export default function CalendarScreen() {
  const { colors } = useTheme();
  const [attendanceConfirmed, setAttendanceConfirmed] = useState(false);

  // ============================================================
  // TODO(eliminar lÃ­neas 17-18): Reemplazar con llamada al backend
  // Descomentar lÃ­neas 20-24 cuando el backend estÃ© listo
  // ============================================================
  const matchData = MOCK_MATCH;

  // BACKEND READY - Descomentar:
  // const [matchData, setMatchData] = useState<any>(null);
  // useEffect(() => {
  //   api.get(API_ENDPOINTS.GET_CALENDAR)
  //     .then(res => setMatchData(res.data.nextMatch));
  // }, []);

  const handleConfirmAttendance = (willAttend: boolean) => {
    // ============================================================
    // TODO(eliminar lÃ­neas 30-37): Reemplazar mock con llamada real al backend
    // Descomentar lÃ­neas 39-44 cuando el backend estÃ© listo
    // ============================================================
    setAttendanceConfirmed(true);
    Alert.alert(
      'Asistencia confirmada',
      willAttend
        ? 'Javier asistirÃ¡ al partido. Llegada confirmada a las 10:15'
        : 'Has indicado que Javier no podrÃ¡ asistir al partido',
    );

    // BACKEND READY - Descomentar:
    // api.post(API_ENDPOINTS.CONFIRM_ATTENDANCE(matchData.id), { willAttend })
    //   .then(() => {
    //     setAttendanceConfirmed(true);
    //     Alert.alert('Asistencia confirmada', willAttend ? 'Asistencia registrada' : 'Ausencia registrada');
    //   })
    //   .catch(err => Alert.alert('Error', 'No se pudo confirmar asistencia'));
  };

  return (
    <SafeAreaView style={{ flex: 1, backgroundColor: colors.background }}>
      <ScrollView contentContainerStyle={styles.container}>
        <Text style={[styles.pageTitle, { color: colors.greenHouse['700'] }]}>
          ðŸ“… CALENDARIO FAMILIAR
        </Text>
        <Text style={[styles.weekRange, { color: colors.mutedForeground }]}>
          SEMANA 15-21 ENERO
        </Text>

        <Card>
          <View style={styles.matchHeader}>
            {/* TODO(eliminar lÃ­neas 68-85): Cambiar MOCK_MATCH por matchData del backend */}
            <Text style={[styles.matchDay, { color: colors.greenHouse['700'] }]}>
              {matchData.day}
            </Text>
            <Text style={[styles.matchEvent, { color: colors.foreground }]}>
              {matchData.event}
            </Text>
            <Text style={[styles.matchTime, { color: colors.mutedForeground }]}>
              {matchData.time}
            </Text>
            <Text style={[styles.matchVersus, { color: colors.foreground }]}>
              {matchData.versus}
            </Text>
            <Text style={[styles.matchLocation, { color: colors.mutedForeground }]}>
              {matchData.location}
            </Text>
            <Text style={[styles.matchAddress, { color: colors.mutedForeground }]}>
              {matchData.address}
            </Text>
          </View>

          <View style={[styles.divider, { backgroundColor: colors.border }]} />

          <Text style={[styles.sectionTitle, { color: colors.foreground }]}>
            INFORMACIÃ“N COMPLETA:
          </Text>

          {Object.values(matchData.details).map((detail, index) => (
            <Text key={index} style={[styles.detailText, { color: colors.mutedForeground }]}>
              {detail}
            </Text>
          ))}
        </Card>

        {/* Attendance Confirmation */}
        <Card title="Confirmar Asistencia" description="Partido: SÃ¡bado 20 Enero - 11:00">
          {!attendanceConfirmed ? (
            <View>
              <Text style={[styles.questionText, { color: colors.foreground }]}>
                Â¿Javier asistirÃ¡ al partido?
              </Text>
              <View style={styles.buttonContainer}>
                <Button
                  title="âœ… SÃ, estarÃ¡ presente (10:15)"
                  variant="primary"
                  onPress={() => handleConfirmAttendance(true)}
                />
                <View style={{ height: 12 }} />
                <Button
                  title="âŒ NO, no podrÃ¡ asistir"
                  variant="outline"
                  onPress={() => handleConfirmAttendance(false)}
                />
              </View>
            </View>
          ) : (
            <View style={styles.confirmedContainer}>
              <Text style={[styles.confirmedText, { color: colors.greenHouse['700'] }]}>
                âœ… Asistencia confirmada
              </Text>
              <Text style={[styles.confirmedSubtext, { color: colors.mutedForeground }]}>
                Puedes modificar tu respuesta hasta el dÃ­a del evento
              </Text>
            </View>
          )}
        </Card>
      </ScrollView>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    padding: 20,
    paddingBottom: 40,
  },
  pageTitle: {
    fontSize: 24,
    fontWeight: '700',
    marginBottom: 4,
  },
  weekRange: {
    fontSize: 16,
    marginBottom: 20,
  },
  matchHeader: {
    marginBottom: 16,
  },
  matchDay: {
    fontSize: 18,
    fontWeight: '700',
    marginBottom: 8,
  },
  matchEvent: {
    fontSize: 16,
    fontWeight: '600',
    marginBottom: 4,
  },
  matchTime: {
    fontSize: 14,
    marginBottom: 2,
  },
  matchVersus: {
    fontSize: 15,
    fontWeight: '600',
    marginBottom: 8,
  },
  matchLocation: {
    fontSize: 14,
    marginBottom: 2,
  },
  matchAddress: {
    fontSize: 14,
    marginLeft: 16,
  },
  divider: {
    height: 1,
    marginVertical: 16,
  },
  sectionTitle: {
    fontSize: 16,
    fontWeight: '700',
    marginBottom: 12,
  },
  detailText: {
    fontSize: 14,
    marginBottom: 8,
  },
  questionText: {
    fontSize: 15,
    fontWeight: '600',
    marginBottom: 16,
  },
  buttonContainer: {
    marginTop: 8,
  },
  confirmedContainer: {
    alignItems: 'center',
    paddingVertical: 16,
  },
  confirmedText: {
    fontSize: 18,
    fontWeight: '700',
    marginBottom: 8,
  },
  confirmedSubtext: {
    fontSize: 13,
    textAlign: 'center',
  },
});
